

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>geos.geometry &mdash; GEOS 0.2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="GEOS 0.2.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GEOS
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Google Earth Overlay Server (GEOS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users.html#more-maps">More maps!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users.html#creating-mapsources">Creating Mapsources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers.html">Using GEOS as library</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GEOS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>geos.geometry</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for geos.geometry</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Conversions between WGS84, Cartesian, Mercator and TMS coordinates and bounding boxes,</span>
<span class="sd">useful for converting geographic view ports as generated by Google Earth to TMS bounding boxes</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Martin Loetzsch, Gregor Sturm&quot;</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="s2">&quot;Apache 2.0&quot;</span>

<span class="n">_earthradius</span> <span class="o">=</span> <span class="mf">6378137.0</span>  <span class="c1"># m</span>

<span class="n">_tilesize</span> <span class="o">=</span> <span class="n">_initialresolution</span> <span class="o">=</span> <span class="n">_originshift</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_originshift_180</span> <span class="o">=</span> <span class="n">_180_originshift</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">_pi_2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="n">_pi_180</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
<span class="n">_pi_360</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">360.0</span>
<span class="n">_180_pi</span> <span class="o">=</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>


<div class="viewcode-block" id="init_geometry"><a class="viewcode-back" href="../../developers.html#geos.geometry.init_geometry">[docs]</a><span class="k">def</span> <span class="nf">init_geometry</span><span class="p">(</span><span class="n">tilesize</span><span class="o">=</span><span class="mf">256.0</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_tilesize</span><span class="p">,</span> <span class="n">_initialresolution</span><span class="p">,</span> <span class="n">_originshift</span>
    <span class="k">global</span> <span class="n">_originshift_180</span><span class="p">,</span> <span class="n">_180_originshift</span>
    <span class="n">_tilesize</span> <span class="o">=</span> <span class="n">tilesize</span>
    <span class="n">_initialresolution</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">_earthradius</span> <span class="o">/</span> <span class="n">_tilesize</span>
    <span class="n">_originshift</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">_earthradius</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">_originshift_180</span> <span class="o">=</span> <span class="n">_originshift</span> <span class="o">/</span> <span class="mf">180.0</span>
    <span class="n">_180_originshift</span> <span class="o">=</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_originshift</span></div>


<span class="n">init_geometry</span><span class="p">()</span>


<div class="viewcode-block" id="griditer"><a class="viewcode-back" href="../../developers.html#geos.geometry.griditer">[docs]</a><span class="k">def</span> <span class="nf">griditer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through a grid of tiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): x start-coordinate</span>
<span class="sd">        y (int): y start-coordinate</span>
<span class="sd">        ncol (int): number of tile columns</span>
<span class="sd">        nrow (int): number of tile rows. If not specified, this</span>
<span class="sd">            defaults to ncol, s.t. a quadratic region is</span>
<span class="sd">            generated</span>
<span class="sd">        step (int): clear. Analogous to range().</span>

<span class="sd">    Yields:</span>
<span class="sd">        Tuple: all tuples (x, y) in the region delimited by</span>
<span class="sd">            (x, y), (x + ncol, y + ncol).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nrow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="n">ncol</span>
    <span class="k">yield from</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">step</span><span class="p">),</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span></div>


<div class="viewcode-block" id="bboxiter"><a class="viewcode-back" href="../../developers.html#geos.geometry.bboxiter">[docs]</a><span class="k">def</span> <span class="nf">bboxiter</span><span class="p">(</span><span class="n">tile_bounds</span><span class="p">,</span> <span class="n">tiles_per_row_per_region</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through a grid of regions defined by a TileBB.</span>

<span class="sd">    Args:</span>
<span class="sd">        tile_bounds (GridBB):</span>
<span class="sd">        tiles_per_row_per_region: Combine multiple tiles in one region.</span>
<span class="sd">            E.g. if set to two, four tiles will be combined in one region.</span>
<span class="sd">            See `kml` module description for more details. Leaving the</span>
<span class="sd">            default value &#39;1&#39; simply yields all tiles in the bounding box.</span>

<span class="sd">    Note:</span>
<span class="sd">        If the number of regions would not be an integer due to specification</span>
<span class="sd">        of the `tiles_per_row_per_region` parameter, the boundaries will</span>
<span class="sd">        be rounded to the next smaller or next larger integer respectively.</span>

<span class="sd">        Example:</span>
<span class="sd">        We have the following bounding box with size 2x2 and set</span>
<span class="sd">        tiles_per_row_per_region = 2, delimited by the coordinates (x, y)::</span>

<span class="sd">             (5,5)--- ---</span>
<span class="sd">                 |       |</span>
<span class="sd">                 |       |</span>
<span class="sd">                 |       |</span>
<span class="sd">                  --- ---(9,7)</span>

<span class="sd">        Although this could be represented in one single region with two</span>
<span class="sd">        tiles per row, it will create four regions::</span>

<span class="sd">             (2,2)--- ---         (5/2 = 2.5 -&gt; 2, 5/2 = 2.5 -&gt; 2)</span>
<span class="sd">                 |   |   |</span>
<span class="sd">                  --- ---</span>
<span class="sd">                 |   |   |</span>
<span class="sd">                  --- ---(5,4)    (9/2 = 4.5 -&gt; 5, 7/2 = 3.5 -&gt; 4)</span>


<span class="sd">    Yields:</span>
<span class="sd">        Tuple: all tuples (x, y) in the region delimited by the TileBB</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_lower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">tile_bounds</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">tiles_per_row_per_region</span><span class="p">)</span>
    <span class="n">y_lower</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">tile_bounds</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">tiles_per_row_per_region</span><span class="p">)</span>
    <span class="n">ncol</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">tile_bounds</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">tiles_per_row_per_region</span><span class="p">)</span> <span class="o">-</span> <span class="n">x_lower</span>
    <span class="n">nrow</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">tile_bounds</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">tiles_per_row_per_region</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_lower</span>
    <span class="k">yield from</span> <span class="n">griditer</span><span class="p">(</span><span class="n">x_lower</span><span class="p">,</span> <span class="n">y_lower</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeographicCoordinate"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicCoordinate">[docs]</a><span class="k">class</span> <span class="nc">GeographicCoordinate</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a WGS84 Datum</span>

<span class="sd">    Args:</span>
<span class="sd">        lon: longitude in degrees</span>
<span class="sd">        lat: latitude in degrees</span>
<span class="sd">        height: height in meters above the surface of the earth spheroid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>

<div class="viewcode-block" id="GeographicCoordinate.to_cartesian"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicCoordinate.to_cartesian">[docs]</a>    <span class="k">def</span> <span class="nf">to_cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">_earthradius</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="n">cosx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">_pi_180</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">cosy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">_pi_180</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">sinx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">_pi_180</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">siny</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">_pi_180</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CartesianCoordinate</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">cosy</span> <span class="o">*</span> <span class="n">cosx</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cosy</span> <span class="o">*</span> <span class="n">sinx</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="n">siny</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeographicCoordinate.to_mercator"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicCoordinate.to_mercator">[docs]</a>    <span class="k">def</span> <span class="nf">to_mercator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MercatorCoordinate</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">*</span> <span class="n">_originshift_180</span><span class="p">,</span>
            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="mi">90</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">_pi_360</span><span class="p">))</span> <span class="o">/</span> <span class="n">_pi_180</span> <span class="o">*</span> <span class="n">_originshift_180</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;lon: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, lat: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, height: &quot;</span> \
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span></div>


<div class="viewcode-block" id="GeographicBB"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicBB">[docs]</a><span class="k">class</span> <span class="nc">GeographicBB</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A bounding box defined by two geographic coordinates &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_lat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">GeographicCoordinate</span><span class="p">(</span><span class="n">min_lon</span><span class="p">,</span> <span class="n">min_lat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">GeographicCoordinate</span><span class="p">(</span><span class="n">max_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">)</span>

<div class="viewcode-block" id="GeographicBB.intersects"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicBB.intersects">[docs]</a>    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lon</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lon</span> <span class="ow">and</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lat</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lat</span></div>

<div class="viewcode-block" id="GeographicBB.intersection"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicBB.intersection">[docs]</a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">intersects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intersects</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeographicBB</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lon</span><span class="p">),</span>
                                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span>
                                <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lon</span><span class="p">),</span>
                                <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lon</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeographicBB</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="mf">360.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeographicBB.center"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicBB.center">[docs]</a>    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GeographicCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeographicBB.to_mercator"><a class="viewcode-back" href="../../developers.html#geos.geometry.GeographicBB.to_mercator">[docs]</a>    <span class="k">def</span> <span class="nf">to_mercator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MercatorBB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">to_mercator</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">to_mercator</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;geographic min: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, max: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span></div>


<div class="viewcode-block" id="CartesianCoordinate"><a class="viewcode-back" href="../../developers.html#geos.geometry.CartesianCoordinate">[docs]</a><span class="k">class</span> <span class="nc">CartesianCoordinate</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Represents a coordinate in a geocentric Cartesian coordinate system &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CartesianCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

<div class="viewcode-block" id="CartesianCoordinate.length"><a class="viewcode-back" href="../../developers.html#geos.geometry.CartesianCoordinate.length">[docs]</a>    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;x: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, y: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, z: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span></div>


<div class="viewcode-block" id="MercatorCoordinate"><a class="viewcode-back" href="../../developers.html#geos.geometry.MercatorCoordinate">[docs]</a><span class="k">class</span> <span class="nc">MercatorCoordinate</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Represents a coordinate in Spherical Mercator EPSG:900913 &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

<div class="viewcode-block" id="MercatorCoordinate.to_tile"><a class="viewcode-back" href="../../developers.html#geos.geometry.MercatorCoordinate.to_tile">[docs]</a>    <span class="k">def</span> <span class="nf">to_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_initialresolution</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">zoom</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(((</span><span class="n">x</span> <span class="o">+</span> <span class="n">_originshift</span><span class="p">)</span> <span class="o">/</span> <span class="n">res</span><span class="p">)</span> <span class="o">/</span> <span class="n">_tilesize</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">TileCoordinate</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                              <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">zoom</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span></div>

<div class="viewcode-block" id="MercatorCoordinate.to_geographic"><a class="viewcode-back" href="../../developers.html#geos.geometry.MercatorCoordinate.to_geographic">[docs]</a>    <span class="k">def</span> <span class="nf">to_geographic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GeographicCoordinate</span><span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_180_originshift</span><span class="p">,</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_180_originshift</span> <span class="o">*</span> <span class="n">_pi_180</span><span class="p">))</span> <span class="o">-</span> <span class="n">_pi_2</span><span class="p">)</span> \
                 <span class="o">*</span> <span class="n">_180_pi</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;x: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, y: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span></div>


<div class="viewcode-block" id="MercatorBB"><a class="viewcode-back" href="../../developers.html#geos.geometry.MercatorBB">[docs]</a><span class="k">class</span> <span class="nc">MercatorBB</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A bounding box defined by two mercator coordinates &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_min</span><span class="o">=</span><span class="n">MercatorCoordinate</span><span class="p">,</span> <span class="n">_max</span><span class="o">=</span><span class="n">MercatorCoordinate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">_max</span>

<div class="viewcode-block" id="MercatorBB.to_tile"><a class="viewcode-back" href="../../developers.html#geos.geometry.MercatorBB.to_tile">[docs]</a>    <span class="k">def</span> <span class="nf">to_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Converts EPSG:900913 to tile coordinates in given zoom level &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">to_tile</span><span class="p">(</span><span class="n">zoom</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">to_tile</span><span class="p">(</span><span class="n">zoom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GridBB</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;mercator min: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, max: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span></div>


<div class="viewcode-block" id="GridCoordinate"><a class="viewcode-back" href="../../developers.html#geos.geometry.GridCoordinate">[docs]</a><span class="k">class</span> <span class="nc">GridCoordinate</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a position in a worldwide grid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

<div class="viewcode-block" id="GridCoordinate.zoom_in"><a class="viewcode-back" href="../../developers.html#geos.geometry.GridCoordinate.zoom_in">[docs]</a>    <span class="k">def</span> <span class="nf">zoom_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields:</span>
<span class="sd">            GridCoordinate: the four tiles of the next zoom level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="GridCoordinate.encode_quad_tree"><a class="viewcode-back" href="../../developers.html#geos.geometry.GridCoordinate.encode_quad_tree">[docs]</a>    <span class="k">def</span> <span class="nf">encode_quad_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">quad_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">ty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">digit</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tx</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">digit</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ty</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">digit</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">quad_key</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">quad_key</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;zoom: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, x: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, y: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span></div>


<div class="viewcode-block" id="TileCoordinate"><a class="viewcode-back" href="../../developers.html#geos.geometry.TileCoordinate">[docs]</a><span class="k">class</span> <span class="nc">TileCoordinate</span><span class="p">(</span><span class="n">GridCoordinate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a coordinate in a worldwide tile grid. (aka the google-system)&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TileCoordinate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<div class="viewcode-block" id="TileCoordinate.to_mercator"><a class="viewcode-back" href="../../developers.html#geos.geometry.TileCoordinate.to_mercator">[docs]</a>    <span class="k">def</span> <span class="nf">to_mercator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_initialresolution</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MercatorCoordinate</span><span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_tilesize</span> <span class="o">*</span> <span class="n">res</span> <span class="o">-</span> <span class="n">_originshift</span><span class="p">,</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">_tilesize</span> <span class="o">*</span> <span class="n">res</span> <span class="o">-</span> <span class="n">_originshift</span><span class="p">)</span></div>

<div class="viewcode-block" id="TileCoordinate.to_geographic"><a class="viewcode-back" href="../../developers.html#geos.geometry.TileCoordinate.to_geographic">[docs]</a>    <span class="k">def</span> <span class="nf">to_geographic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_mercator</span><span class="p">()</span><span class="o">.</span><span class="n">to_geographic</span><span class="p">()</span></div>

<div class="viewcode-block" id="TileCoordinate.geographic_bounds"><a class="viewcode-back" href="../../developers.html#geos.geometry.TileCoordinate.geographic_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">geographic_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_geographic</span><span class="p">()</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">TileCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_geographic</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">GeographicBB</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span></div>

<div class="viewcode-block" id="TileCoordinate.zoom_in"><a class="viewcode-back" href="../../developers.html#geos.geometry.TileCoordinate.zoom_in">[docs]</a>    <span class="k">def</span> <span class="nf">zoom_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">griditer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">TileCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="TileCoordinate.resolution"><a class="viewcode-back" href="../../developers.html#geos.geometry.TileCoordinate.resolution">[docs]</a>    <span class="k">def</span> <span class="nf">resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the tile resolution at the current position.</span>

<span class="sd">        The scale in WG84 depends on</span>
<span class="sd">            * the zoom level (obviously)</span>
<span class="sd">            * the latitude</span>
<span class="sd">            * the tile size</span>

<span class="sd">        References:</span>
<span class="sd">            * http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#Resolution_and_Scale</span>
<span class="sd">            * http://gis.stackexchange.com/questions/7430/what-ratio-scales-do-google-maps-zoom-levels-correspond-to</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: meters per pixel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geo_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_geographic</span><span class="p">()</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_initialresolution</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">geo_coords</span><span class="o">.</span><span class="n">lat</span> <span class="o">*</span> <span class="n">_pi_180</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">resolution</span></div></div>


<div class="viewcode-block" id="RegionCoordinate"><a class="viewcode-back" href="../../developers.html#geos.geometry.RegionCoordinate">[docs]</a><span class="k">class</span> <span class="nc">RegionCoordinate</span><span class="p">(</span><span class="n">GridCoordinate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a region containing multiple tiles in a worldwide grid of regions.</span>

<span class="sd">    A region is a square containing multiple tiles, e.g.::</span>

<span class="sd">         -- --</span>
<span class="sd">        | 1| 2|</span>
<span class="sd">         -- --</span>
<span class="sd">        | 3| 4|</span>
<span class="sd">         -- --</span>

<span class="sd">    A region must contain at least one tile and each row must have</span>
<span class="sd">    a power of two of tiles. The size of the region is specified</span>
<span class="sd">    with log2(tiles per row per region), e.g.</span>

<span class="sd">        * log_tiles_per_row = 0 means 2**0 = 1 tile</span>
<span class="sd">        * log_tiles_per_row = 2 means 2**2 = 4 tiles per row, thus 16 tiles per region.</span>

<span class="sd">    Args:</span>
<span class="sd">        zoom (int): clear.</span>
<span class="sd">        x (int): clear.</span>
<span class="sd">        y (int): clear.</span>
<span class="sd">        log_tiles_per_row (int): size of the region as log2(tiles per row per region).</span>
<span class="sd">        needs to be at least 0 (-&gt; 1 tile) and at most 4 (-&gt; 256 tiles)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">log_tiles_per_row</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">log_tiles_per_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_tiles_per_row</span> <span class="o">=</span> <span class="n">log_tiles_per_row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tiles_per_row</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">log_tiles_per_row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span> <span class="o">=</span> <span class="n">TileCoordinate</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles_per_row</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles_per_row</span><span class="p">)</span>

<div class="viewcode-block" id="RegionCoordinate.geographic_bounds"><a class="viewcode-back" href="../../developers.html#geos.geometry.RegionCoordinate.geographic_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">geographic_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span><span class="o">.</span><span class="n">to_geographic</span><span class="p">()</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">TileCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles_per_row</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles_per_row</span><span class="p">)</span><span class="o">.</span><span class="n">to_geographic</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">GeographicBB</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span></div>

<div class="viewcode-block" id="RegionCoordinate.get_tiles"><a class="viewcode-back" href="../../developers.html#geos.geometry.RegionCoordinate.get_tiles">[docs]</a>    <span class="k">def</span> <span class="nf">get_tiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all TileCoordinates contained in the region&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">griditer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tiles_per_row</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">TileCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_tile</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="RegionCoordinate.zoom_in"><a class="viewcode-back" href="../../developers.html#geos.geometry.RegionCoordinate.zoom_in">[docs]</a>    <span class="k">def</span> <span class="nf">zoom_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">griditer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">RegionCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">log_tiles_per_row</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_tiles_per_row</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&lt;zoom: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, x: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, y: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span>
                <span class="s2">&quot;, log_tiles_per_row: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_tiles_per_row</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridBB"><a class="viewcode-back" href="../../developers.html#geos.geometry.GridBB">[docs]</a><span class="k">class</span> <span class="nc">GridBB</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A bounding box defined by two grid coordinates &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">GridCoordinate</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">GridCoordinate</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>

<div class="viewcode-block" id="GridBB.intersection"><a class="viewcode-back" href="../../developers.html#geos.geometry.GridBB.intersection">[docs]</a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">intersects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">x</span> <span class="ow">and</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">y</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">y</span>
        <span class="k">if</span> <span class="n">intersects</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GridBB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span>
                          <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                          <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                          <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                          <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="GridBB.intersections"><a class="viewcode-back" href="../../developers.html#geos.geometry.GridBB.intersections">[docs]</a>    <span class="k">def</span> <span class="nf">intersections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">intersections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">:</span> <span class="n">intersections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">GridBB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span> <span class="n">intersections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">intersections</span></div>

<div class="viewcode-block" id="GridBB.is_inside"><a class="viewcode-back" href="../../developers.html#geos.geometry.GridBB.is_inside">[docs]</a>    <span class="k">def</span> <span class="nf">is_inside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">tile</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">y</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">tile</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">tile</span><span class="o">.</span><span class="n">zoom</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span>
                 <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">tile</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">x</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">tile</span><span class="o">.</span><span class="n">zoom</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;tile min: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, max: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Gregor Sturm.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>